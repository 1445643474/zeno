file(GLOB dirs LIST_DIRECTORIES TRUE CONFIGURE_DEPENDS *)

message(WARNING "dirs are: ${dirs}")
foreach (dir ${dirs})
    if (IS_DIRECTORY ${dir})
        cmake_path(GET dir FILENAME name)
        option(WITH_${name} "Build with module ${name}" ON)
        message(WARNING "WITH_${name}: ${WITH_${name}}")
        if (WITH_${name})
            add_subdirectory(${name})
        endif()
    endif()
endforeach()
